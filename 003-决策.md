# 第三章 决策

## 3.1 比较运算符

要做出决策，需要一种比较机制。C 标准中提供了 **关系运算符** 和 **相等运算符** 用于比较两个操作数。下表列出了这些运算符

|运算符|描述||运算符|描述|
|:---|:---|---|:---|:---|
|`<`|小于||`<=`|小于或等于|
|`>`|大于||`>=`|大于或等于|
|`==`|等于||`!=`|不等于|

这些运算符的工作方式就像我们期待的那样。假设有两个整型变量 `i` 和 `j`，它们的值分别为 $10$ 和 $-5$，下面的几个表达式说明了这些运算符的工作原理

```c
i > j;          // i = 10, j = -5               ==> 10 > -5  ==> true
i != j;         // i = 10, j = -5               ==> 10 != -5 ==> true
j > -8;         // j = -5                       ==> -5 > -8  ==> true
i <= j + 15;    // i = 10, j = -5, j + 15 = 10  ==> 10 <= 10 ==> true 
```

上述表达式的结果都是 `true`。请注意，最后一个表达式中，子表达式 `j + 15` 要先执行，因为运算符 `<=` 的优先级低于运算符 `+`。比较运算符返回的结果是 `bool` 类型的值，因此，我们可以将比较运算的结果存储在一个 `bool` 类型中

```c
bool isValid = i > j;
```

浮点数比较的一个奇特之处在于，只要有一个操作数是 `NaN`，则比较结果一定为 `false`。例如

```c
printf("%d\n", 1 > 0.0 / 0.0 );  // 结果为 0
```

比较运算符也可以直接比较两个字符，由于在 C 语言中，字符本质上就是整数，比较字符相当于比较字符编码值。例如

```c
char first = 'A';
char last = 'Z';

first < last;  // true
'E' < first;   // false
first != last; // true
```

下面的示例演示了比较运算符的工作方式

```c title="ex03_01.c"
/**
 * ex03_01.c - 演示比较运算符
 * 
**/
#include <stdio.h>

int main(void)
{
    char first;
    char second;
    printf("Enter a character: ");
    scanf("%c%*c", &first);
    printf("Enter a second character: ");
    scanf("%c%*c", &second);

    printf("The value of the expression %c < %c is %d.\n", first, second, first < second);
    printf("The value of the expression %c == %c is %d.\n", first, second, first == second);
    return 0;
}
// ex03_01.c
```

## 3.2 if 语句

`if` 语句允许程序通过测试表达式的值从两种选项中选择一种。`if` 语句的最简单格式如下

```c
// expression 为 true 时执行一条语句
if (expression)
    statement;
```

请注意，`expression` 两边的圆括号是必不可少的，它们是 `if` 语句的组成部分，而不是表达式的。当程序执行 `if` 语句时，会先检查 `expression` 表达式的值，如果为 `true`，即非零值，则执行语句 `statement`。下图演示了 `if` 语句的执行流程

![260301010153034.png](https://fastly.jsdelivr.net/gh/duyupeng36/images@master/2026-03/1772298122572.png)

> [!warning]
>
> 请注意，`statement` 可以单独的一条语句，也可以是 **块语句**。在 C 语言中，**块语句** 也称为复合语句，由包围在花括号内任意条语句组成。

```c
if (expression)
{
    statement1;
    statement2;
    // ...
}
```

在上述代码片段中，由花括号 `{}` 包围的语句集合称为 **块语句**，也称为复合语句。在块语句中，可以声明名字，这些名字只在该语句块内访问

下面的示例程序演示了 `if` 语句，这个示例程序检查从键盘上输入的一个整数值

```c title="ex03_02.c"
/**
 * ex03_02.c - 检查从键盘上输入的一个整数值
 * 
**/
#include <stdio.h>

int main(void)
{
    printf("Enter an integer between 50 and 100: ");
    int value = 0;
    scanf("%d%*c", &value);

    // true ==> 非零; false ==> 0
    if (value)
    {
        printf("You have entered a value that is different from zero.\n");
    }

    if (value < 50)
    {
        printf("The value is invalid - it is less than 50.\n");
    }

    if (value > 100)
    {
        printf("The value is invalid - it is greater than 100.\n");
    }
    printf("You entered value is %d.\n", value);
    return 0;
}
// ex03_02.c
```

### 3.2.1 else 子句

`if` 语句可以带有一个可选的 `else` 子句。一个完整的 `if` 语句的如下

```c
if (expression)
    statement;
else
    statement;
```

当表达式 `expression` 的值为 `false` 时，就执行 `else` 后边的语句。下面的示例代码，演示了 `if-else` 语句的使用，这个示例代码从键盘中读入一个整数，判断该整数是否是偶数

```c title="ex03_03.c"
/**
 * ex03_03.c - 检查一个数是否为偶数
 * 
**/
#include <stdio.h>

int main(void)
{
    
    long number = 0;
    printf("Enter an integer less than 2 billion: ");
    scanf("%d%*c", &number);

    if (number % 2) 
    {
        printf("Your number is odd.");
    }
    else
    {
        printf("Your number is even.");
    }
    return 0;
}
// ex03_03.c
```

### 3.2.2 嵌套的 if

C 标准对出现在 `if` 语句内部的语句是没有任何要求的，甚至可以出现另一个 `if` 语句，也就是嵌套的 `if` 语句。例如

```c
if (coffee == 'y')
    if (donuts == 'y')
        printf("We have coffee and donuts.");
    else
        printf("We have coffee, but not donuts.");
```

这里我们使用缩进表示 `else` 子句属于内部的 `if`。如果缩进使用错误，将导致错误的结论

```c
if (coffee == 'y')
    if (donuts == 'y')
        printf("We have coffee and donuts.");
else
    printf("We have coffee, but not donuts.");
```

这个缩进表示 `else` 子句属于外层 `if`。但是，编译器却不会这么认为，而是将 `else` 匹配给最近的 `if`。因此，这里最好是使用花括号

```c
if (coffee == 'y')
{
    if (donuts == 'y')
        printf("We have coffee and donuts.");
    else
        printf("We have coffee, but not donuts.");
}
```

有时候我们需要判定一系列的条件，一旦其中某一个条件为真就立刻停止。例如

```c
if (n < 0)
    printf("n is less than 0.\n");
else
    if (n == 0)
        printf("n is equal to 0.\n");
    else 
        printf("n is greater than 0.\n");
```

第二个 `if` 语句是嵌套在第一个 `if` 语句内部的，但是 C 语言程序员通常不会对它进行缩进，而是把每个 `else` 都与最初的 `if` 对齐

```c
if (n < 0)
    printf("n is less than 0.\n");
else if (n == 0)
        printf("n is equal to 0.\n");
else 
    printf("n is greater than 0.\n");
```

这样的安排带给嵌套 `if` 语句独特的书写形式

```c
if (expression)
    statement
else if (expression)
    statement
...
else if (expression)
    statement
else
    statement
```

> [!tip]
>
> `if - else if - else` 形式的语句只是嵌套在 `else` 子句中的 `if` 语句的特殊书写形式，并不是一个全新的语句

下面的示例程序演示一个完整的 `if` 语句用法，该示例程序用于计算股票经纪人的佣金。投资者通过股票经纪人进行股票交易时，会按照下表列出的交易额给付给股票经纪人佣金

|交易额|佣金|
|:----|:---|
|$\lt 2500$|$30 + 1.7\% * 交易额$|
|$2500 \sim 6250$|$56 + 0.66\% * 交易额$|
|$6250 \sim 20\ 000$|$76 + 0.34\% * 交易额$|
|$20\ 000 \sim 50\ 000$|$100 + 0.22\% * 交易额$|
|$50\ 000 \sim 500\ 000$|$155 + 0.11\% * 交易额$|
|$\gt 500\ 000$|$255 + 0.09\% * 交易额$|

```c title="ex03_04.c"
/**
 * ex03_04.c - 计算股票经纪人的佣金
 * 
**/
#include <stdio.h>

int main(void)
{
    double amount = 0;       // 交易额
    double commission = 0;  // 佣金
    
    printf("Enter your transaction amount: ");
    scanf("%lf%*c", &amount);

    if (amount < 2500.)
        commission = 30 + 0.017 * amount;
    else if (amount < 6250) // 走到这分支，代表 amount 一定是大于 2500.
        commission = 56 + 0.0066 * amount;
    else if (amount < 20000)
        commission = 76 + 0.0034 * amount;
    else if (amount < 50000)
        commission = 100 + 0.0022 * amount;
    else if (amount < 500000)
        commission = 155 + 0.0011 * amount;
    else
        commission = 255 + 0.0009 * amount;

    printf("Your transaction amount is %.2f$, and you must pay commission %.2f$.", amount, commission);

    return 0;
}
// ex03_04.c
```

## 3.2 逻辑运算符

在有两个或更多相关条件的地方使用 `if` 语句较为繁杂。例如，搜索年龄在 $21 \sim 35$ 之间、拥有学士或硕士学历、未婚的女性。在使用 `if` 语句是就需要层层嵌套下去。这会导致 `if` 语句嵌套的非常深。

**逻辑运算符** 则提供了一种简洁的解决方案。使用逻辑运算符，可以把一系列的比较组合到一个表达式中，这样无论条件多么复杂，都可以使用一个 `if` 语句解决。下表列出了 C 语言提供了 $3$ 个逻辑运算符

|逻辑运算符|描述|
|:--------|:---|
|`&&`|逻辑与, 检查两个操作数是否同时为 `true`|
|<code>&#124;&#124;</code>|逻辑或, 检查两个操作数是否有一个为 `true`|
|`!`|逻辑非, 对操作数的逻辑值取反|

运算符 `&&` 和 `||` 是二元运算符，其优先级低于比较运算符，它们组合两个类型为 `bool` 的操作数，生成 `bool` 类型的结果。

具体来说，逻辑运算符 `&&` 在两个操作数都为 `true` 时，生成的结果才是 `true`，否则结果为 `false`；逻辑运算符 `||` 在两个操作数中有一个为 `true` 时，生成的结果为 `true`，否则结果为 `false`。运算符 `!` 是一元运算符，它作用于一个 `bool` 类型的操作数，返回操作数相反的 `bool` 值

例如，为了判断字符是否是大写字母，我们可以编写如下 `if` 语句

```c
if (letter >= 'A' && letter <= 'Z')
    printf("This letter is an uppercase.\n");
```

在来看一个使用逻辑或的场景。当我们向银行申请贷款时，银行会一般银行会根据个人的年薪或存款等判断我们是否有还款能力。假设，银行要求年薪至少是 $10$ 万，或者拥有 $100$ 万的现金存款

```c
if (income >= 10 || capital >= 100)
    printf("Of course, how much do you wantto borrow?: \n");
```

下面的示例程序演示了条件表达式和逻辑运算符组在一起的使用场景。该示例程序用于确定一个人是否有贷款风险

```c title="ex03_05.c"
/**
 * ex03_05.c - 确定一个人是否有贷款风险
 * 
**/
#include <stdio.h>

int main(void)
{
    int age = 0;
    int income = 0;
    int balance = 0; 

    printf("Please enter your age in years: ");
    scanf("%d%*c", &age);
    printf("Please enter your annual income in dollars: ");
    scanf("%d%*c", &income);
    printf("Please enter your current account balance in dollars: ");
    scanf("%d%*c", &balance);

    // 年至少 21 岁, 年薪 25000 或拥有存款 100000
    if (age >= 21 && (income >= 25000 || balance >= 100000))
    {
        // 可以贷款，计算贷款最大金额。年薪的两倍和存款一半中最小的
        int loan = 0;
        
        if (2 * income < balance / 2)
        {
            loan = 2 * income;
        }
        else
        {
            loan = balance / 2;
        }
        printf("\nYou can borrow up to $%d.", loan);
    }
    else
    {
        printf("\nUnfortunately, you don't qualify for a loan.");
    }
    return 0;
}
// ex03_05.c
```

> [!warning]
>
> 表达式 `age >= 21 && (income >= 25000 || balance >= 100000)` 中的括号是不必可少的，因为运算符 `&&` 的优先级高于运算符 `||`。
>
> 如果没有括号，表达式 `age >= 21 && income >= 25000 || balance >= 100000` 的计算结果就变成了 `(age >= 21 && income >= 25000) || balance >= 100000`
>
> 换句话说，在组合逻辑运算符是，建议总是添加圆括号来提高代码清晰度

逻辑运算符 `&&` 和 `||` 还具有一个非常有用的特性，就是 **短路特性**。对于逻辑运算符组成的表达式，将整个表达式将从左到右对逻辑运算符 `&&` 和 `||` 的操作数进行求值，一旦发现能够确定整个表达式的值，就会立即返回并且不在计算后续表达式的值

```c
int x = 2;
if (x < 0 && (x * x + 632 * x == 1268))
    printf("Congrats: %d is the correct solution!", x);
```

对于表达式 `x < 0 && (x * x + 632 * x == 1268)`，`x < 0` 的值为 `false`，因此第二个表达式 `x * x + 632 * x == 1268` 将不在进行计算。

## 3.3 条件运算符

条件运算符也称为 **三元运算符**，因为它涉及三个操作数，这也是 C 语言中唯一的三元运算符。它是简单 `if-else` 语句的简化版本。例如，比较两个数，获取其中最大的数，使用 `if-else` 语句完成如下

```c
int max;
if (a > b)
    max = a;
else
    max = b;
```

对于这种形式的 `if-else` 语句，我们可以使用更简单的条件运算符

```c
int max = a > b ? a : b;
```

条件运算符通用表示形式为

```c
expression1 ? expression2 : expression3;
```

这个表达式会首先计算 `expression1` 的值，如果 `expression1` 的值为 `true`，则计算 `expression2` 的值，整个表达式的值就是 `expression2` 的值。如果 `expression1` 的值为 `false`，则计算 `expression3` 的值，整个表达式的值就是 `expression3` 的值

```c title="ex03_06.c"
/**
 * ex03_06.c - 使用条件运算符控制输出
 * 
**/
#include <stdio.h>

int main(void)
{
    
    bool flag = true;  // c23 标准
    printf("%s\n", flag ? "true": "false");
    return 0;
}
// ex03_06.c
```


